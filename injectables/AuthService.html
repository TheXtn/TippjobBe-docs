<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>server documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top d-block d-sm-none">
            <a href="../" class="navbar-brand">server documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >AuthService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/auth/auth.service.ts</code>
        </p>





            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#changeEmail" >changeEmail</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#ChangePassword" >ChangePassword</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#changePwd" >changePwd</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#create" >create</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#generateResetPwd" >generateResetPwd</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getTokens" >getTokens</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getUser" >getUser</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getUserById" >getUserById</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#handleChangeEmail" >handleChangeEmail</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#login" >login</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#logout" >logout</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#refreshTokens" >refreshTokens</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#resetPwd" >resetPwd</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateRtHash" >updateRtHash</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateSettings" >updateSettings</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#verifyUser" >verifyUser</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(prisma: <a href="../injectables/PrismaService.html" target="_self">PrismaService</a>, jwt: JwtService, mailservice: <a href="../injectables/MailjetService.html" target="_self">MailjetService</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="25" class="link-to-prism">src/auth/auth.service.ts:25</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>prisma</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/PrismaService.html" target="_self" >PrismaService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>jwt</td>
                                                  
                                                        <td>
                                                                    <code>JwtService</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>mailservice</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/MailjetService.html" target="_self" >MailjetService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="changeEmail"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>changeEmail</b></span>
                        <a href="#changeEmail"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>changeEmail(user: <a href="../classes/User.html" target="_self">User</a>, password: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, newEmail: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="481"
                            class="link-to-prism">src/auth/auth.service.ts:481</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>SERVICE TO CHANGE USER EMAIL</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../classes/User.html" target="_self" >User</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>password</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>newEmail</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;literal type | undefined&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="ChangePassword"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>ChangePassword</b></span>
                        <a href="#ChangePassword"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>ChangePassword(user: <a href="../classes/User.html" target="_self">User</a>, changePasswordDto: <a href="../classes/ChangePasswordDto.html" target="_self">ChangePasswordDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="422"
                            class="link-to-prism">src/auth/auth.service.ts:422</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../classes/User.html" target="_self" >User</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>changePasswordDto</td>
                                    <td>
                                                <code><a href="../classes/ChangePasswordDto.html" target="_self" >ChangePasswordDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;User&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="changePwd"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>changePwd</b></span>
                        <a href="#changePwd"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>changePwd(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, newPassword: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="141"
                            class="link-to-prism">src/auth/auth.service.ts:141</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>newPassword</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;User&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="create"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>create</b></span>
                        <a href="#create"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>create(createUserDto: <a href="../classes/CreateUserDto.html" target="_self">CreateUserDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="33"
                            class="link-to-prism">src/auth/auth.service.ts:33</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>createUserDto</td>
                                    <td>
                                                <code><a href="../classes/CreateUserDto.html" target="_self" >CreateUserDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="generateResetPwd"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>generateResetPwd</b></span>
                        <a href="#generateResetPwd"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>generateResetPwd(email: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="101"
                            class="link-to-prism">src/auth/auth.service.ts:101</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>email</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;literal type&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getTokens"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>getTokens</b></span>
                        <a href="#getTokens"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getTokens(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, email: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="300"
                            class="link-to-prism">src/auth/auth.service.ts:300</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>email</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../miscellaneous/typealiases.html#Tokens" target="_self" >Promise&lt;Tokens&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getUser"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>getUser</b></span>
                        <a href="#getUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getUser(user: <a href="../classes/User.html" target="_self">User</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="347"
                            class="link-to-prism">src/auth/auth.service.ts:347</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../classes/User.html" target="_self" >User</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getUserById"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>getUserById</b></span>
                        <a href="#getUserById"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getUserById(user: <a href="../classes/User.html" target="_self">User</a>, id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="364"
                            class="link-to-prism">src/auth/auth.service.ts:364</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../classes/User.html" target="_self" >User</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;User | null&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="handleChangeEmail"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>handleChangeEmail</b></span>
                        <a href="#handleChangeEmail"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>handleChangeEmail(token: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="554"
                            class="link-to-prism">src/auth/auth.service.ts:554</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>SERVICE TO HANDLE CHANGE USER EMAIL</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>token</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../miscellaneous/typealiases.html#Tokens" target="_self" >Promise&lt;Tokens&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="login"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>login</b></span>
                        <a href="#login"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>login(CreateAuthDto: <a href="../classes/CreateAuthDto.html" target="_self">CreateAuthDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="241"
                            class="link-to-prism">src/auth/auth.service.ts:241</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>CreateAuthDto</td>
                                    <td>
                                                <code><a href="../classes/CreateAuthDto.html" target="_self" >CreateAuthDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="logout"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>logout</b></span>
                        <a href="#logout"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>logout(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="186"
                            class="link-to-prism">src/auth/auth.service.ts:186</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="refreshTokens"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>refreshTokens</b></span>
                        <a href="#refreshTokens"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>refreshTokens(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, refresh_token: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="203"
                            class="link-to-prism">src/auth/auth.service.ts:203</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>refresh_token</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../miscellaneous/typealiases.html#Tokens" target="_self" >Promise&lt;Tokens&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="resetPwd"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>resetPwd</b></span>
                        <a href="#resetPwd"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>resetPwd(token: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, updatePwdDto: <a href="../classes/UpdatePwdDto.html" target="_self">UpdatePwdDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="154"
                            class="link-to-prism">src/auth/auth.service.ts:154</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>token</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>updatePwdDto</td>
                                    <td>
                                                <code><a href="../classes/UpdatePwdDto.html" target="_self" >UpdatePwdDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;literal type&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateRtHash"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateRtHash</b></span>
                        <a href="#updateRtHash"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateRtHash(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, refresh_token: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="327"
                            class="link-to-prism">src/auth/auth.service.ts:327</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>refresh_token</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateSettings"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateSettings</b></span>
                        <a href="#updateSettings"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateSettings(user: <a href="../classes/User.html" target="_self">User</a>, setUserSettingsDto: <a href="../classes/SetUserSettingsDto.html" target="_self">SetUserSettingsDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="403"
                            class="link-to-prism">src/auth/auth.service.ts:403</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../classes/User.html" target="_self" >User</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>setUserSettingsDto</td>
                                    <td>
                                                <code><a href="../classes/SetUserSettingsDto.html" target="_self" >SetUserSettingsDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;User&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="verifyUser"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>verifyUser</b></span>
                        <a href="#verifyUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>verifyUser(token: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="66"
                            class="link-to-prism">src/auth/auth.service.ts:66</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>token</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;literal type&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {
  Injectable,
  HttpException,
  ForbiddenException,
  NotFoundException,
  BadRequestException,
  UnauthorizedException,
} from &#x27;@nestjs/common&#x27;;
import { PrismaService } from &#x27;../prisma/prisma.service&#x27;;
import { CreateUserDto } from &#x27;./dto/create-user.dto&#x27;;
import { CreateAuthDto } from &#x27;./dto/create-auth.dto&#x27;;
import { v4 as uuidv4 } from &#x27;uuid&#x27;;
import { compareHash, hash } from &#x27;./utils/bcrypt&#x27;;
import { JwtService } from &#x27;@nestjs/jwt&#x27;;
import { JwtPayload, Tokens } from &#x27;./types&#x27;;
import { User } from &#x27;@prisma/client&#x27;;
import { UpdatePwdDto } from &#x27;./dto/update-pwd.dto&#x27;;
import { MailjetService } from &#x27;../mailjet/mailjet.service&#x27;;
import * as moment from &#x27;moment&#x27;;
import { SetUserSettingsDto } from &#x27;./dto/update-user-settings.dto&#x27;;
import * as _ from &#x27;lodash&#x27;;
import { compareHashStrings, hashString } from &#x27;./utils/argon&#x27;;
import { ChangePasswordDto } from &#x27;./dto/change-pwd.dto&#x27;;
@Injectable()
export class AuthService {
  constructor(
    private prisma: PrismaService,
    private jwt: JwtService,
    private mailservice: MailjetService,
  ) {}

  //-------------------USER REGISTRATION-------------------//
  async create(createUserDto: CreateUserDto) {
    //GENRATE A VERIFICATION TOKEN (UUID)
    const verificationHash &#x3D; uuidv4();
    //HASH THE PASSWORD
    const hashedpwd &#x3D; await hash(createUserDto.password);
    //CREATE USER OBJECT
    createUserDto.password &#x3D; hashedpwd;
    const user &#x3D; await this.prisma.user.create({
      data: createUserDto,
    });

    //CREATE VERIFICATION OBJECT
    await this.prisma.emailVerification.create({
      data: {
        user: {
          connect: { id: user.id },
        },
        hash: verificationHash,
      },
    });
    //INVOKE EMAIL TOKEN SEND !
    const verificationLink &#x3D; &#x60;${process.env.FRONT_URL}/?login&#x3D;true&amp;token&#x3D;${verificationHash}&#x60;;
    const result &#x3D; await this.mailservice.sendEmail(
      createUserDto.email,
      user.firstName,
      verificationLink,
      4635399,
    );
    if (result !&#x3D; 200) {
      throw new BadRequestException(&#x27;Error in mail service&#x27;);
    }
    return { message: &#x27;Registration succeed , verification link sent &#x27; };
  }
  async verifyUser(
    token: string,
  ): Promise&lt;{ message: string; verified: boolean }&gt; {
    //GET THE ASSOSCIATED USER FOR A GIVIN TOKEN
    const dbToken &#x3D; await this.prisma.emailVerification.findUnique({
      where: {
        hash: token,
      },
      select: {
        user: true,
      },
    });
    //IN CASE IF TOKEN PROVIDED DOES NOT EXIST OR INVALID
    if (!dbToken) {
      throw new NotFoundException(&#x27;Token is not valid&#x27;);
    }
    //VERIFY THE USER IN CASE TOKEN VALIDATION
    await this.prisma.user.update({
      where: {
        id: dbToken.user.id,
      },
      data: {
        emailVerified: true,
      },
    });
    //REMOVE THE TOKEN (DATABASE STORAGE OPTIMIZATION)
    await this.prisma.emailVerification.delete({
      where: {
        hash: token,
      },
    });
    //RETURN TRUE IF USER HAS VERIFIED ELSE STAY AT THE DEFAULT VALUE (FALSE)
    return { message: &#x27;User has been verified&#x27;, verified: true };
  }
  //PASSWORD RESET GENERATION
  async generateResetPwd(email: string): Promise&lt;{ message: string }&gt; {
    //GENERATE A TOKEN
    const resetHash &#x3D; uuidv4();
    //GET THE USER ASSOCIATED WITH THE EMAIL
    const user &#x3D; await this.prisma.user.findUnique({
      where: {
        email,
      },
    });
    if (!user) {
      throw new NotFoundException(&#x27;No user found with this email&#x27;);
    }
    await this.prisma.resetPassword.upsert({
      where: {
        userId: user.id,
      },
      //IN CASE THERE IS ALREADY A TOKEN HASH
      update: {
        hash: resetHash,
      },
      create: {
        userId: user.id,
        hash: resetHash,
      },
    });
    //INVOKE EMAIL TOKEN SEND !
    const restLink &#x3D; &#x60;${process.env.FRONT_URL}/reset/${resetHash}&#x60;;
    const result &#x3D; await this.mailservice.sendEmail(
      email,
      user.firstName,
      restLink,
      4634945,
    );
    if (result !&#x3D; 200) {
      throw new BadRequestException(&#x27;Error in mail service&#x27;);
    }
    return { message: &#x27;Email reset link sent&#x27; };
  }
  //PASSWORD RESET (PWD CHANGING)
  //FUNCTION THAT UPDATES A USER PASSWORD
  async changePwd(userId: string, newPassword: string): Promise&lt;User&gt; {
    const hashedpwd &#x3D; await hash(newPassword);
    const user &#x3D; await this.prisma.user.update({
      where: {
        id: userId,
      },
      data: {
        password: hashedpwd,
      },
    });
    return user;
  }
  //HANDLE PASSWORD CHANGE (PROVIDED BY THE TOKEN)
  async resetPwd(
    token: string,
    updatePwdDto: UpdatePwdDto,
  ): Promise&lt;{ message: string }&gt; {
    //GET THE USER ASSOCIATED WITH THE EMAIL
    const tokenUser &#x3D; await this.prisma.resetPassword.findFirst({
      where: {
        hash: token,
      },
      include: {
        user: true,
      },
    });
    if (!tokenUser) {
      throw new NotFoundException(&#x27;Token is not valid&#x27;);
    }
    // Check if the token has expired
    const tokenCreatedAt &#x3D; moment(tokenUser.createdAt);
    const now &#x3D; moment();
    const diff &#x3D; moment.duration(now.diff(tokenCreatedAt)).asHours();
    if (diff &gt; 12) {
      throw new BadRequestException(&#x27;Token has expired&#x27;);
    }
    // TOKEN IS VALID
    await this.changePwd(tokenUser.user.id, updatePwdDto.password);
    return { message: &#x27;Password changed successfully &#x27; };
  }
  //-----------------------------------------------------------//

  //-------------------USER AUTHENTICATION-------------------//

  //logging out the user
  async logout(userId: string): Promise&lt;boolean&gt; {
    //delete the refresh token hash associated with the user
    await this.prisma.refreshToken.delete({
      where: {
        userId: userId,
      },
    });
    throw new HttpException(
      {
        message: &#x27;Logout successful&#x27;,
        status: 200,
      },
      200,
    );
  }

  //refreshing the access token
  async refreshTokens(userId: string, refresh_token: string): Promise&lt;Tokens&gt; {
    //fetching the user from the database
    const user &#x3D; await this.prisma.user.findUnique({
      where: {
        id: userId,
      },
      include: {
        refreshToken: true,
      },
    });
    console.log(
      &#x60;Refresh token called for user ${user?.email} at ${new Date()}&#x60;,
    );
    //checking if the refresh token exists (preventing null pointer exception)
    if (user?.refreshToken) {
      const { refreshToken, email } &#x3D; user;
      if (!refreshToken?.hash) throw new ForbiddenException(&#x27;Access Denied&#x27;);
      //verifying the refresh token hash
      const verify &#x3D; await compareHashStrings(
        refresh_token,
        user.refreshToken.hash,
      );
      if (!verify) throw new ForbiddenException(&#x27;Access Denied&#x27;);

      //generating new tokens
      const tokens &#x3D; await this.getTokens(userId, email);

      //updating the refresh token hash in the database
      await this.updateRtHash(userId, tokens.refresh_token);
      console.log(
        &#x60;Refresh token generated for user ${user?.email} at ${new Date()}&#x60;,
      );
      return tokens;
    }
    throw new NotFoundException(&#x27;No User Found&#x27;);
  }

  //logging in the user
  async login(CreateAuthDto: CreateAuthDto) {
    //fetching the user from the database
    const user &#x3D; await this.prisma.user.findUnique({
      where: { email: CreateAuthDto.email },
    });

    //checking if the user exists
    if (!user) {
      throw new HttpException(
        {
          message: &#x27;Invalid Credentials&#x27;,
          status: 401,
        },
        401,
      );
    }

    //comparing password hashes
    if (!(await compareHash(CreateAuthDto.password, user.password))) {
      throw new HttpException(
        {
          message: &#x27;Invalid Credentials&#x27;,
          status: 401,
        },
        401,
      );
    }
    //checking if the email is verified
    if (!user.emailVerified) {
      throw new HttpException(
        {
          message: &#x27;Email not verified&#x27;,
          status: 401,
        },
        401,
      );
    }

    //generating tokens accesss and refresh
    const tokens &#x3D; await this.getTokens(user.id, user.email);
    await this.updateRtHash(user.id, tokens.refresh_token);

    //return the user&#x27;s tokens
    throw new HttpException(
      {
        message: &#x27;Welcome &#x27; + user.firstName,
        tokens: tokens,
        status: 200,
      },
      200,
    );
  }
  //-----------------------------------------------------------//
  //-------------------OTHER SERVICES-------------------//

  //-----------------------------------------------------------//
  //-------------------HELPER FUNCTIONS-------------------//

  //GENERATING ACCESS AND REFRESH TOKENS
  async getTokens(userId: string, email: string): Promise&lt;Tokens&gt; {
    //payload to be encoded in the token
    const jwtPayload: JwtPayload &#x3D; {
      id: userId,
      email: email,
    };

    //generating access and refresh tokens
    const [access_token, refresh_token] &#x3D; await Promise.all([
      this.jwt.signAsync(jwtPayload, {
        secret: process.env.JWT_SECRET,
        expiresIn: &#x27;15m&#x27;,
      }),
      this.jwt.signAsync(jwtPayload, {
        secret: process.env.JWT_REFRESH_SECRET,
        expiresIn: &#x27;7d&#x27;,
      }),
    ]);

    //returning the tokens
    return {
      access_token,
      refresh_token,
    };
  }

  //UPDATING THE REFRESH TOKEN HASH IN THE DATABASE
  async updateRtHash(userId: string, refresh_token: string): Promise&lt;void&gt; {
    //hashing the refresh token
    const Refresh_Token_Hash &#x3D; await hashString(refresh_token);

    //updating the refresh token hash in the database
    await this.prisma.refreshToken.upsert({
      where: {
        userId,
      },
      update: {
        hash: Refresh_Token_Hash,
      },
      create: {
        userId,
        hash: Refresh_Token_Hash,
      },
    });
  }
  //-----------------------------------------------------------//
  //GETTING A USER FROM DATABASE
  async getUser(user: User) {
    const currentUser &#x3D; await this.prisma.user.findUnique({
      where: {
        id: user.id,
      },
      include: {
        profile: {
          include: {
            activity: true,
          },
        },
      },
    });
    const userWithoutpwd &#x3D; _.omit(currentUser, &#x27;password&#x27;);
    return userWithoutpwd;
  }
  //SERVICE TO GET USER BY ID
  async getUserById(user: User, id: string): Promise&lt;User | null&gt; {
    if (!id) {
      return null;
    }
    //GET THE CURRENT USER (JWT USER)
    const currentUser &#x3D; await this.prisma.user.findUnique({
      where: { id: user.id },
    });
    if (!currentUser) {
      throw new UnauthorizedException(&#x27;Unauthorized&#x27;);
    }
    //GET THE USER BASE ON THE ID PATH PARAM
    const dbUser &#x3D; await this.prisma.user.findUnique({
      where: {
        id: id,
      },
      include: {
        profile: {
          include: {
            activity: true,
          },
        },
      },
    });
    if (dbUser) {
      if (dbUser.visibility &#x3D;&#x3D; &#x27;PUBLIC&#x27;) {
        return dbUser;
      }
      if (
        dbUser.visibility &#x3D;&#x3D; &#x27;COMPANY&#x27; &amp;&amp;
        currentUser?.userType &#x3D;&#x3D; &#x27;COMPANY&#x27;
      ) {
        return dbUser;
      }
    }
    return null;
  }

  //SERVICE TO UPDATE USER SETTINGS
  async updateSettings(
    user: User,
    setUserSettingsDto: SetUserSettingsDto,
  ): Promise&lt;User&gt; {
    //GET THE CURRENT USER (JWT USER)
    const currentUser &#x3D; await this.prisma.user.findUnique({
      where: { id: user.id },
    });
    //UPDATE THE USER
    const updatedUser &#x3D; await this.prisma.user.update({
      where: {
        id: currentUser?.id,
      },
      data: setUserSettingsDto,
    });
    return updatedUser;
  }

  //SERVICE TO UPDATE USER PASSWORD BASED ON OLD PASSWORD
  async ChangePassword(
    user: User,
    changePasswordDto: ChangePasswordDto,
  ): Promise&lt;User&gt; {
    //GET THE CURRENT USER (JWT USER)
    const currentUser &#x3D; await this.prisma.user.findUnique({
      where: { id: user.id },
    });
    //CHECK IF THE USER EXISTS
    if (!currentUser) {
      throw new HttpException(
        {
          message: &#x27;User not found&#x27;,
          status: 404,
        },
        404,
      );
    }
    //check if the new password is the same as the old one
    if (await compareHash(changePasswordDto.newPassword, currentUser?.password))
      throw new HttpException(
        {
          message: &#x27;New Password cannot be the same as the old one&#x27;,
          status: 400,
        },
        400,
      );

    //CHECK IF THE PASSWORD IS CORRECT
    if (
      !(await compareHash(
        changePasswordDto.currentPassword,
        currentUser?.password,
      ))
    )
      throw new HttpException(
        {
          message: &#x27;Old Password is incorrect&#x27;,
          status: 401,
        },
        401,
      );
    //UPDATE THE USER
    const updatedUser &#x3D; await this.prisma.user.update({
      where: {
        id: currentUser?.id,
      },
      data: {
        password: await hash(changePasswordDto.newPassword),
      },
    });
    return updatedUser;
  }
  /**
   * SERVICE TO CHANGE USER EMAIL
   * @param {User} user
   * @param {string} newEmail
   * @returns {User}
   */
  async changeEmail(
    user: User,
    password: string,
    newEmail: string,
  ): Promise&lt;{ message: string } | undefined&gt; {
    const currentUser &#x3D; await this.prisma.user.findUnique({
      where: {
        id: user.id,
      },
    });
    if (currentUser) {
      //check password
      if (!(await compareHash(password, currentUser?.password)))
        throw new HttpException(
          {
            message: &#x27;Password is incorrect&#x27;,
            status: 401,
          },
          401,
        );
      //check if email is already taken
      const emailExists &#x3D; await this.prisma.user.findUnique({
        where: {
          email: newEmail,
        },
      });
      if (emailExists) {
        throw new HttpException(
          {
            message: &#x27;Email already taken&#x27;,
            status: 409,
          },
          409,
        );
      }

      const verificationHash &#x3D; uuidv4();
      await this.prisma.emailChange.upsert({
        where: {
          userId: user.id,
        },
        update: {
          hash: verificationHash,
          newEmail: newEmail,
        },
        create: {
          newEmail: newEmail,
          user: {
            connect: { id: user.id },
          },
          hash: verificationHash,
        },
      });
      //INVOKE EMAIL TOKEN SEND !
      const verificationLink &#x3D; &#x60;${process.env.FRONT_URL}/?login&#x3D;true&amp;token&#x3D;${verificationHash}&#x60;;
      const result &#x3D; await this.mailservice.sendEmail(
        newEmail,
        currentUser.firstName,
        verificationLink,
        4767586,
      );
      if (result !&#x3D; 200) {
        throw new BadRequestException(&#x27;Error in mail service&#x27;);
      }
      return { message: &#x27;Verification link sent &#x27; };
    }
  }
  /**
   * SERVICE TO HANDLE CHANGE USER EMAIL
   * @param {User} user
   * @param {string} token
   * @returns {User}
   */
  async handleChangeEmail(token: string): Promise&lt;Tokens&gt; {
    //GET THE ASSOSCIATED USER FOR A GIVIN TOKEN
    const dbToken &#x3D; await this.prisma.emailChange.findUnique({
      where: {
        hash: token,
      },
      select: {
        newEmail: true,
        user: true,
      },
    });
    //IN CASE IF TOKEN PROVIDED DOES NOT EXIST OR INVALID
    if (!dbToken) {
      throw new NotFoundException(&#x27;Token is not valid&#x27;);
    }
    //UPDATE USER IN CASE TOKEN VALIDATION
    const updatedUser &#x3D; await this.prisma.user.update({
      where: {
        id: dbToken.user.id,
      },
      data: {
        email: dbToken.newEmail,
      },
    });
    //REMOVE THE TOKEN (DATABASE STORAGE OPTIMIZATION)
    await this.prisma.emailChange.delete({
      where: {
        hash: token,
      },
    });
    //RETURN TRUE IF USER HAS VERIFIED ELSE STAY AT THE DEFAULT VALUE (FALSE)
    const tokens &#x3D; await this.getTokens(updatedUser.id, updatedUser.email);
    return tokens;
  }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'AuthService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
